amr.n_cell = $num_cell_x $num_cell_y $num_cell_z

hipace.normalized_units = 0
hipace.bxby_solver = explicit

hipace.dt = $time_step # TODO: set automatic timestep
amr.blocking_factor = 1
amr.max_level = 0

hipace.verbose = 1
max_step = $max_step # TODO: set automatic timestep
hipace.output_period = $output_period

hipace.depos_order_xy = 1

geometry.coord_sys   = 0                  # 0: Cartesian
geometry.is_periodic = 1 1 0  # Is periodic?
geometry.prob_lo     = $grid_low_x $grid_low_y $grid_low_z     # physical domain
geometry.prob_hi     = $grid_high_x $grid_high_y $grid_high_z

beams.names = $beam_components # 'driver' or 'driver beam'
beams.insitu_period = 1

beam.injection_type = from_file
beam.input_file = $filename_beam
beam.iteration = 0
beam.do_radiation_reaction = $radiation_reaction

driver.injection_type = from_file
driver.input_file = $filename_driver
driver.iteration = 0

# external focusing
${external_focusing_radial_comment}beams.external_B(x,y,z,t) = "$external_focusing_radial*y" "-$external_focusing_radial*x" "0.0"

plasmas.names = $plasma_components # 'plasma' or 'electrons ions'

# if ion motion disabled
${density_comment1}plasma.density(x,y,z) = $plasma_density
${density_comment2}plasma.density_table_file = $density_table_file 
plasma.ppc = 1 1
plasma.element = electron
plasma.do_symmetrize = 1


# if ion motion enabled
electrons.element = electron
${density_comment1}electrons.density(x,y,z) = $plasma_density
${density_comment2}electrons.density_table_file = $density_table_file 
electrons.do_symmetrize = 1
electrons.ppc = 1 1
electrons.neutralize_background = 0

ions.element = $ion_species
${density_comment1}ions.density(x,y,z) = $plasma_density
${density_comment2}ions.density_table_file = $density_table_file 
ions.do_symmetrize = 1
ions.ppc = 1 1
ions.neutralize_background = 0
ions.can_ionize = $beam_ionization
ions.initial_ion_level = 1
ions.ionization_product = electrons

diagnostic.diag_type = xz
diagnostic.field_data = Ez ExmBy rho jz_beam
